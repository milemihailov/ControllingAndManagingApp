@page "/printersettings"
@using MachineControlHub
@using MachineControlHub.Material
@inject Data.PrinterDataServiceTest printer

@* <MudCard>
    <MudCardHeader>
        <MudText Typo="Typo.h6">Bed Shape</MudText>
    </MudCardHeader>
    <MudSelect T="string" Label="Select bed shape" @bind-Value="printer.selectedShape" Variant="Variant.Outlined">
        <MudSelectItem Value="@("Rectangular")" />
        <MudSelectItem Value="@("Circular")" />
        <MudSelectItem Value="@("Custom")" />
    </MudSelect>
    <MudCardContent>
        @if (printer.selectedShape == "Rectangular")
        {
            <MudNumericField Label="Y Axis in mm" @bind-Value="printer.Printer.Bed.YSize" Immediate="true" Variant="Variant.Outlined" />
            <MudNumericField Label="X Axis in mm" @bind-Value="printer.Printer.Bed.XSize" Immediate="true" Variant="Variant.Outlined" />
        }
        else if (printer.selectedShape == "Circular")
        {
            <MudNumericField Label="Diameter in mm" @bind-Value="printer.Printer.Bed.Diameter" Immediate="true" Variant="Variant.Outlined" />
        }
        else if (printer.selectedShape == "Custom")
        {
            <MudNumericField Label="Y Axis in mm" @bind-Value="printer.Printer.Bed.YSize" Immediate="true" Variant="Variant.Outlined" />
            <MudNumericField Label="X Axis in mm" @bind-Value="printer.Printer.Bed.XSize" Immediate="true" Variant="Variant.Outlined" />
        }
    </MudCardContent>

    <MudCardContent>
        <MudTextField @bind-Value="printer.Printer.Name" Label="Printer Name" Variant="Variant.Outlined" />
        <MudTextField @bind-Value="printer.Printer.Model" Label="Printer Model" Variant="Variant.Outlined" />
        <MudTextField @bind-Value="printer.Printer.PrinterFirmwareVersion" Label="Firmware Version" Variant="Variant.Outlined" />
    </MudCardContent>

    <MudCardContent>
        <MudSwitch Color="Color.Success" @bind-Value="printer.Printer.HasAutoBedLevel" Label="Has Auto Bed Level" />
        <MudSwitch Color="Color.Success" @bind-Value="printer.Printer.HasHeatedBed" Label="Has Heated Bed" />
        <MudSwitch Color="Color.Success" @bind-Value="printer.Printer.HasChamber" Label="Has Chamber" />
        <MudSwitch Color="Color.Success" @bind-Value="printer.Printer.HasFilamentRunoutSensor" Label="Has Filament Sensor" />
        <MudSwitch Color="Color.Success" @bind-Value="printer.HasCamera" Label="Has Camera" />
        @if (printer.HasCamera)
        {
            <MudTextField @bind-Value="printer.Printer.Camera.Model" Label="Camera Model" Variant="Variant.Outlined" />
            <MudTextField @bind-Value="printer.Printer.Camera.ResolutionHeight" Label="Resolution Height" Variant="Variant.Outlined" />
            <MudTextField @bind-Value="printer.Printer.Camera.ResolutionWidth" Label="Resolution Width" Variant="Variant.Outlined" />
            <MudTextField @bind-Value="printer.Printer.Camera.LensFocalLength" Label="Lens Focal Length" Variant="Variant.Outlined" />
        }

            //TODO: Implement these
        <MudSwitch @bind-Checked="printer.HasPowerLossRecovery" Label="Has Power Loss Recovery" />
        <MudSwitch @bind-Checked="printer.HasDisplay" Label="Has Display" />
        <MudSwitch @bind-Checked="printer.HasDualZ" Label="Has Dual Z" />
        <MudSwitch @bind-Checked="printer.HasEnclosure" Label="Has Enclosure" />
        <MudSwitch @bind-Checked="printer.HasDryBox" Label="Has Dry Box" />
        <MudSwitch @bind-Checked="printer.HasCamera" Label="Has Camera" />
        <MudSwitch @bind-Checked="printer.HasNetwork" Label="Has Network" />
        <MudSwitch @bind-Checked="printer.HasOctoPrint" Label="Has OctoPrint" />
        <MudSwitch @bind-Checked="printer.HasWebcam" Label="Has Webcam" />
        <MudSwitch @bind-Checked="printer.HasWebcamStream" Label="Has Webcam Stream" />
        <MudSwitch @bind-Checked="printer.HasWebcamSnapshot" Label="Has Webcam Snapshot" />
        <MudSwitch @bind-Checked="printer.HasWebcamTimelapse" Label="Has Webcam Timelapse" />
    </MudCardContent>
</MudCard> *@

@* <MudCard>
    <MudCardHeader>
        <MudText Typo="Typo.h6">Set if your machine has multiple extruders</MudText>
    </MudCardHeader>
    <MudCardContent>
        <MudNumericField @bind-Value="printer.Printer.NumberOfExtruders" Label="Number of Extruders" Variant="Variant.Text" Min="1" Max="10" />
        <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="() => printer.UpdateExtruders(printer.Printer.NumberOfExtruders)">Set Extruder Properties</MudButton>
        @foreach (var extruder in printer.ExtruderSettings)
        {
            <MudExpansionPanel Text=@($"Set Your Settings For Extruder #{printer.ExtruderSettings.IndexOf(extruder) + 1}")>
                <MudCardContent>
                    <MudTextField @bind-Value="extruder.NozzleMaterial" Label="Nozzle Material" Variant="Variant.Outlined" />
                    <MudNumericField @bind-Value="extruder.NozzleDiameter" Label="Nozzle Diameter" Variant="Variant.Text" />
                    <MudSwitch Color="Color.Success" @bind-Value="extruder.HasCoolingFan" Label="Has Part Cooling Fan" />
                    <MudSwitch Color="Color.Success" @bind-Value="extruder.ProbePresent" Label="Has Probe" />
                </MudCardContent>
            </MudExpansionPanel>
        }
    </MudCardContent>
</MudCard>
<MudButton Type="submit" OnClick="() => printer.CreatePrinterProfile()" Color="Color.Success" Variant="Variant.Filled" FullWidth="true">Create Printer Profile</MudButton>


<MudCard>
    <MudCardHeader>
        <MudText Typo="Typo.h6">Set Offsets</MudText>
        <MudNumericField @bind-Value="printer.Printer.MotionSettings.XHomeOffset" Label="X Offset" Variant="Variant.Outlined" />
        <MudNumericField @bind-Value="printer.Printer.MotionSettings.YHomeOffset" Label="Y Offset" Variant="Variant.Outlined" />
        <MudNumericField @bind-Value="printer.Printer.MotionSettings.ZHomeOffset" Label="Z Offset" Variant="Variant.Outlined" />
    </MudCardHeader>

    <MudCardHeader>
        <MudText Typo="Typo.h6">Set Max Feedrates</MudText>
        <MudNumericField @bind-Value="printer.Printer.MotionSettings.XMaxFeedrate" Label="X Maximum Feedrate" Variant="Variant.Outlined" />
        <MudNumericField @bind-Value="printer.Printer.MotionSettings.YMaxFeedrate" Label="Y Maximum Feedrate" Variant="Variant.Outlined" />
        <MudNumericField @bind-Value="printer.Printer.MotionSettings.ZMaxFeedrate" Label="Z Maximum Feedrate" Variant="Variant.Outlined" />
        <MudNumericField @bind-Value="printer.Printer.MotionSettings.EMaxFeedrate" Label="E Maximum Feedrate" Variant="Variant.Outlined" />
    </MudCardHeader>

    <MudButton OnClick="printer.SetMaxFeedrates">Set Feedrates to printer</MudButton>
</MudCard> *@

<MudCard>
    <MudCardHeader>
        <MudText Typo="Typo.h6">Create Preheating Profiles</MudText>
    </MudCardHeader>
    <MudCardContent>
        <EditForm Model="printer.Printer.PreheatingProfiles" OnValidSubmit="printer.CreatePreheatProfile">
            <MudTextField @bind-Value="printer.Printer.PreheatingProfiles.MaterialName" Label="Material" Variant="Variant.Outlined" />
            <MudNumericField @bind-Value="printer.Printer.PreheatingProfiles.HotendTemp" Label="Hotend Temperature" Variant="Variant.Outlined" />
            <MudNumericField @bind-Value="printer.Printer.PreheatingProfiles.BedTemp" Label="Bed Temperature" Variant="Variant.Outlined" />
            <MudNumericField @bind-Value="printer.Printer.PreheatingProfiles.FanSpeed" Label="Fan Speed" Variant="Variant.Outlined" />
            <MudNumericField @bind-Value="printer.Printer.PreheatingProfiles.MaterialIndex" Label="Index" Variant="Variant.Outlined" />
            <MudButton Type="submit" OnClick="printer.CreatePreheatProfile" Variant="Variant.Filled" Color="Color.Primary">Save Presets</MudButton>
            <MudButton OnClick="printer.SendPreheatingProfiles">Send Presets To Printer</MudButton>
        </EditForm>
    </MudCardContent>
</MudCard>

<MudCard>
    <MudCardContent>
        <MudText> Printer Settings:</MudText>
        <MudText> Temperature Units: @printer.linearUnits</MudText>
        <MudText> Temperature Units: @printer.temperatureUnits</MudText>
        <MudText> X Steps: @printer.Printer.MotionSettings.XStepsPerUnit</MudText>
        <MudText> Y Steps: @printer.Printer.MotionSettings.YStepsPerUnit</MudText>
        <MudText> Z Steps: @printer.Printer.MotionSettings.ZStepsPerUnit</MudText>
        <MudText> E Steps: @printer.Printer.MotionSettings.EStepsPerUnit</MudText>
        <MudText> X Max Feedrate: @printer.Printer.MotionSettings.XMaxFeedrate</MudText>
        <MudText> Y Max Feedrate: @printer.Printer.MotionSettings.YMaxFeedrate</MudText>
        <MudText> Z Max Feedrate: @printer.Printer.MotionSettings.ZMaxFeedrate</MudText>
        <MudText> E Max Feedrate: @printer.Printer.MotionSettings.EMaxFeedrate</MudText>
        <MudText Typo="Typo.h6"> Hotend Pid Values:</MudText>
        <MudText> P: @printer.Printer.HotendTemperatures.PIDHotendValues.Proportional</MudText>
        <MudText> I: @printer.Printer.HotendTemperatures.PIDHotendValues.Integral</MudText>
        <MudText> D: @printer.Printer.HotendTemperatures.PIDHotendValues.Derivative</MudText>
        <MudText Typo="Typo.h6"> Bed Pid Values:</MudText>

        <MudText> P: @printer.Printer.BedTemperatures.PIDBedValues.Proportional</MudText>
        <MudText> I: @printer.Printer.BedTemperatures.PIDBedValues.Integral</MudText>
        <MudText> D: @printer.Printer.BedTemperatures.PIDBedValues.Derivative</MudText>
        <MudText Typo="Typo.h6">Accelerations</MudText>
        <MudText> Print Acceleration: @printer.Printer.MotionSettings.PrintAcceleration</MudText>
        <MudText> Retract Acceleration: @printer.Printer.MotionSettings.RetractAcceleration</MudText>
        <MudText> Travel Acceleration: @printer.Printer.MotionSettings.TravelAcceleration</MudText>
        <MudText> X Max Acceleration: @printer.Printer.MotionSettings.XMaxAcceleration</MudText>
        <MudText> Y Max Acceleration: @printer.Printer.MotionSettings.YMaxAcceleration</MudText>
        <MudText> Z Max Acceleration: @printer.Printer.MotionSettings.ZMaxAcceleration</MudText>
        <MudText> E Max Acceleration: @printer.Printer.MotionSettings.EMaxAcceleration</MudText>
        <MudText Typo="Typo.h6"> Advanced Settings: </MudText>
        <MudText> Min Segment Time: @printer.Printer.MotionSettings.MinSegmentTime</MudText>
        <MudText> Min Feedrate: @printer.Printer.MotionSettings.MinFeedrate</MudText>
        <MudText> Min Travel Feedrate: @printer.Printer.MotionSettings.MinTravelFeedrate</MudText>
        <MudText> Junction Deviation: @printer.Printer.MotionSettings.JunctionDeviation</MudText>
        <MudText Typo="Typo.h6"> Offset Settings:</MudText>
        <MudText> X Offset: @printer.Printer.MotionSettings.XHomeOffset</MudText>
        <MudText> Y Offset: @printer.Printer.MotionSettings.YHomeOffset</MudText>
        <MudText> Z Offset: @printer.Printer.MotionSettings.ZHomeOffset</MudText>
        <MudText Typo="Typo.h6"> Z-Probe Offsets:</MudText>
        <MudText> X Offset: @printer.Printer.Head.XProbeOffset</MudText>
        <MudText> Y Offset: @printer.Printer.Head.YProbeOffset</MudText>
        <MudText> Z Offset: @printer.Printer.Head.ZProbeOffset</MudText>
        <MudText Typo="Typo.h6"> AutoBed Level:</MudText>
        <MudText> @(printer.Printer.HasAutoBedLevel ? "Enabled" : "Not Enabled") </MudText>
    </MudCardContent>
</MudCard>

@code {
    // [Parameter]
    // public Printer SelectedPrinter { get; set; } = new();
}

